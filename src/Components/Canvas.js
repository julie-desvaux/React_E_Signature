import { useEffect, useState, useRef } from "react";

// COMPONENT
import Button from "./Button";

export default function Canvas({ handleClickValidation }) {
	const [isClicked, setIsClicked] = useState(false);
	const [x, setX] = useState();
	const [y, setY] = useState();
	const cnvEl = useRef(null);
	let canvasEl;
	let context;

	useEffect(() => {
		canvasEl = cnvEl.current;
		context = canvasEl.getContext("2d");
		const mouseDown = () => {
			setIsClicked(true);
			context.beginPath();
		};

		const mouseUp = () => {
			setIsClicked(false);
			setX();
			setY();
		};

		const mouseMove = (evt) => {
			if (isClicked) {
				setX(evt.layerX);
				setY(evt.layerY);
				context.lineWidth = "3";
				context.lineCap = "round";
				context.lineTo(x, y);
				context.stroke();
			}
		};

		canvasEl.addEventListener("mousedown", mouseDown);
		canvasEl.addEventListener("mouseup", mouseUp);
		canvasEl.addEventListener("mousemove", mouseMove);

		return () => {
			canvasEl.removeEventListener("mousedown", mouseDown);
			canvasEl.removeEventListener("mouseup", mouseUp);
			canvasEl.removeEventListener("mousemove", mouseMove);
		};
	}, [isClicked, x, y]);

	const onClickDelete = () => {
		context.clearRect(0, 0, canvasEl.width, canvasEl.height);
	};

	const onClickValidate = () => {
		handleClickValidation(canvasEl.toDataURL());
	};

	return (
		<div className="flex flex-col justify-center items-center">
			<canvas ref={cnvEl} className="border-4 border-dashed border-gray-200 rounded-lg w-80 h-40"></canvas>
			<div className="my-3 flex justify-around items-center w-80">
				<Button onClick={() => onClickValidate()}>Valider</Button>
				<Button onClick={() => onClickDelete()}>Supprimer</Button>
			</div>
			<img
				src="data:image/png;base64,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"
				alt=""
			/>
		</div>
	);
}
